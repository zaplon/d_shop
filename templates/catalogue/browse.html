{% extends 'layout.html' %}
{% load static %}
{% load jstemplate %}

{% block jumbotron %}
{% endblock %}

{% block margin-top %}
    <div id="top-margin-catalogue"></div>
{% endblock %}

{% block breadcrumbs %}
    <div id="top-nav-border"></div>
    <div class="row">
        <div class="col-md-8">
            <ul class="breadcrumb">
                <li><a href="/">Strona główna</a></li>
                {% for p in path_list %}
                    {% if forloop.last %}
                        <li>{{ p.name }}</li>
                    {% else %}
                        <li><a href="{{ p.url }}">{{ p.name }}</a></li>
                    {% endif %}
                {% endfor %}
            </ul>
        </div>
        <div class="col-md-4">
            <div id="filters-list">
                <ul data-bind="foreach: filters">
                    <li data-bind="foreach: selectedOptions">
                        <!--ko text: $parent.name+': '--><!--/ko-->
                        <span data-bind="text: $data,
                        click: $root.removeFilter, attr: {'data-index': $parentContext.$index()}"></span>
                    </li>
                </ul>
            </div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <form id="variables">
        <input type="hidden" name="filters" value="{{ filters }}">
        <input type="hidden" name="categories" value="{{ categories }}">
    </form>
    <div class="row">
        <div class="col-md-2 col-sm-hidden tree-list sidebar">
            <div id="tree" data="{{ tree_data }}"></div>
        </div>
        <div class="col-md-10 col-sm-12">
            <div id="product-filters" class="row">
                <form class="form" data-bind="template: { name: 'filter-template', foreach: filters }">
                </form>
            </div>
            <div class="row m-t-1">
                <div class="col-md-8 col-sm-12">
                    <label class="m-r-2" for="price-slider">Zakres cen</label>
                    <input class="form-control" id="price-slider" type="text" name="prices" />
                </div>
                <div class="col-md-4 col-sm-12">
                    <select class="form-control pull-right"
                            data-bind="options: sortOptions, optionsText: 'name', selectedOptions: selectedSortOption,
                            optionsValue: 'id', event: { change: loadData }">
                    </select>
                </div>
            </div>
            <div id="products-container" data-bind="template: { name: 'product-template', foreach: products }"></div>
        </div>
    </div>
    <div id="products-end"></div>

    <script type="text/html" id="filter-template">
       <div class="col-md-4">
           <select class="form-control selectpicker"
                   multiple
                   data-live-search="true"
                   data-selected-text-format="count > 3"
                   data-bind="options: options, optionsText: 'text', selectedOptions: selectedOptions, optionsValue: 'slug',
                   event: { change: $parent.selectionChanged },
                   optionsAfterRender: $parent.setOptionDisable,
                   attr: { title: name, 'data-max-options': typeof(multiple) == 'undefined' ? '1' : null }">
           </select>
       </div>
    </script>

    <script type="text/html" id="product-template">
       <div class="col-md-4">
            <div class="product-card" data-bind="attr: {'data-id': id}">
                <div class="image">
                    <a data-bind="attr: {href: front_url }"><img data-bind="attr: {src: images[0].original}"/></a>
                </div>
                <div class="title">
                    <a data-bind="attr: {href: front_url }"><h5 data-bind="text: limit(title)"></h5></a>
                </div>
                <div data-bind="if: sell_details.is_available" class="price">
                    <span data-bind="text: sell_details.price.incl_tax"></span>
                </div>
                <div data-bind="if: !sell_details.is_available" class="not-available">
                    <span>Produkt niedostępny</span>
                </div>
            </div>
       </div>
    </script>


{% endblock %}

{% block extrascripts %}
  {% handlebarsjs 'product' precompile %}
  {% handlebarsjs 'filters' precompile %}
  {% handlebarsjs 'add-to-cart' precompile %}
  <script src="{% static "js/catalogue/catalogue.js" %}"></script>
{% endblock %}
