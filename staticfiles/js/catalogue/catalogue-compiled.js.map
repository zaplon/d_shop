{"version":3,"sources":["../../../../../../../../../home/jan/workspace/django_shop/shop/staticfiles/js/catalogue/catalogue.js"],"names":[],"mappings":"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","file":"catalogue-compiled.js","sourcesContent":["\"use  strict\";\nvar Api = (function () {\n    function Api(url) {\n        this.url = url;\n        this.loading = false;\n        this.params = { limit: 0, attributes: '', offset: 0, categories: [] };\n        this.count = 1;\n    }\n    Api.prototype.query = function (limit) {\n        this.loading = true;\n        var _this = this;\n        this.params.limit = limit;\n        if (this.params.offset >= this.count)\n            return;\n        if ('attributes' in this.params && this.params.attributes.length == 0)\n            delete this.params.attributes;\n        $.getJSON(this.url, this.params, function (res) {\n            _this.renderResults(res);\n            _this.appendResults = false;\n            _this.count = res.count;\n            history.pushState('', document.title, api.params.attributes);\n            _this.loading = false;\n        });\n    };\n    Api.prototype.watchResults = function () {\n        if (api.productsEnd.visible() && !api.loading){\n            api.appendResults = true;\n            api.params.offset += 6;\n            api.query(6);\n        }\n    };\n    Api.prototype.renderResults = function (res) {\n        if (!this.appendResults)\n            $('#products-container').html('');\n        else\n            this.productsEnd.remove();\n        for (var r in res.results) {\n            $.ajax({\n                url: \"/api/products/\" + res.results[r].id + \"/price/\",\n                async: false,\n                type: 'GET',\n                success: function(rr){\n                    res.results[r].price = rr;\n                }\n            });\n            $.ajax({\n                url: \"/api/products/\" + res.results[r].id + \"/availability/\",\n                async: false,\n                type: 'GET',\n                success: function(rr){\n                    res.results[r].availability = rr;\n                }\n            });\n            res.currentImage = 0;\n            $('#products-container').append(Handlebars.templates['product'](res.results[r]));\n        }\n\n        var atts = [];\n        if (this.attributes){\n            this.attributes.forEach(function(attribute, i){\n               atts.push([]);\n               attribute.forEach(function(a, j){\n                   var aa = atts[i];\n                   var f = aa.filter(function(at){ return at.name == a.name; });\n                   if (f.length == 0) {\n                       aa.push(a);\n                       aa[aa.length-1].ids = [a.id];\n                   }\n                   else\n                       f[0].ids.push(a.id);\n                   });\n            });\n            $('#filters-list ul').html(Handlebars.templates['filters']({ attributes: atts }));\n        }\n        console.log(this.attributes);\n        $('#products-container').append('<div id=\"products-end\"></div>');\n        this.productsEnd = $('#products-end');\n        $(window).unbind('scroll', this.watchResults);\n        $(window).bind('scroll', this.watchResults);\n        this.products = res.results;\n    };\n    ;\n    return Api;\n}());\nvar api = new Api('/api/products/');\n$(document).ready(function () {\n    $('#products-container').delegate('.image', 'mouseover', function(){\n        var parentId = $(this).parent().attr('data-id');\n        var product = api.products.filter(function(p){ if ( p.id == parentId ) return true; } )[0];\n        var image = $(this).find('img');\n        product.interval = window.setInterval(function(){\n            if (product.currentImage >= product.images.length + 1)\n                product.currentImage = 0;\n            else\n                product.currentImage += 1;\n            image.attr('src', product.images[product.currentImage]);\n        }, 1000);\n    });\n    $('#products-container').delegate('.image', 'mouseout', function(){\n        var parentId = $(this).parent().attr('data-id');\n        var product = api.products.filter(function(p){ if ( p.id == parentId ) return true; } )[0];\n        clearInterval(product.interval);\n    });    \n    var categories = $('#product-categories').val();\n    if (categories)\n        api.params.categories = categories;\n    $('#tree').treeview({\n        enableLinks: true,\n        data: JSON.parse($('#tree').attr('data')), expandIcon: 'fa fa-plus-square',\n        collapseIcon: 'fa fa-minus-square'});\n    $('#filters-list').delegate('li', 'click', function () {\n        console.log('remove');\n        var select = $('select[data-attribute=\"' + $(this).attr('data-attribute') + '\"]');\n        var ids = $(this).attr('data-ids');\n        var values = $(select).selectpicker('val');\n        if (typeof(values) == 'string'){\n            $(select).selectpicker('val', '');\n        }\n        else if (typeof(values) == 'object'){\n            for(var id in ids.split(',')) {\n                values.splice(values.indexOf(ids[id]) - 1, 1);\n            }\n                $(select).selectpicker('val', values);\n        }\n\n        $(this).remove();\n        $(select).selectpicker('refresh');\n        $(select).trigger('change');\n        api.query(12);\n    });\n    var productsEnd = $('#products-end');\n    $('#product-filters select').change(function (e) {\n        var attributes = [];\n        api.params.offset = 0;\n        api.count = 1;\n        $('#product-filters select').each(function (i, s) {\n            var val = $(s).val();\n            if (typeof (val) == 'string' && val != '') {\n                var selected = $(s).find('option:selected');\n                val.split(',').forEach(function(a, i){\n                    attributes.push([{\n                        id: parseInt(a), name: $(selected).attr('name'),\n                        attribute: $(s).attr('data-attribute')\n                    }]);\n                })\n            }\n            else if (typeof (val) == 'object' && val !== null) {\n                attributes.push([]);\n                var a_length_1 = attributes.length - 1;\n                val.forEach(function (v, i) {\n                    v.split(',').forEach(function(a, i){\n                        attributes[a_length_1].push({\n                            id: parseInt(a), name: $(s).find('option[value=\"' + v + '\"]').attr('name'),\n                            attribute: $(s).attr('data-attribute')\n                        });\n                    })\n                });\n            }\n        });\n        api.attributes = attributes;\n        var atts_ids = [];\n        attributes.forEach(function (att, i) {\n            atts_ids.push([]);\n            att.forEach(function (a, j) {\n                atts_ids[atts_ids.length - 1].push(a.id);\n            });\n            atts_ids[atts_ids.length - 1] = atts_ids[atts_ids.length - 1].join('.');\n        });\n        api.params.attributes = atts_ids.join(',');\n        api.query(12);\n    });\n    api.query(12);\n});\n"]}