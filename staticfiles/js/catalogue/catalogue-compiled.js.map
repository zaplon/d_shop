{"version":3,"sources":["../../../../../../../../../home/jan/workspace/django_shop/shop/staticfiles/js/catalogue/catalogue.js"],"names":[],"mappings":"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","file":"catalogue-compiled.js","sourcesContent":["var viewModel = {\n    filters : ko.observableArray([]),\n    products : ko.observableArray([]),\n    categories: $('#variables input[name=\"categories\"]').val(),\n    filterNames: JSON.parse($('#variables input[name=\"filters\"]').val()),\n    limit: 12,\n    offset: 0,\n    loading: false,\n    count: 0,\n    productsEnd: $('#products-end'),\n    setOptionDisable: function(option, item) {\n            ko.applyBindingsToNode(option, {disable: item.disable}, item);\n    },\n    removeFilter: function(value, event){\n        var newOptions = [];\n        var filter = viewModel.filters()[parseInt($(event.target).attr('data-index'))];\n        var options = filter.selectedOptions();\n        for (var o in options){\n            if (options[o] != value)\n                newOptions.push(filter.selectedOptions()[o]);\n        }\n        filter.selectedOptions(newOptions);\n        viewModel.loadData();\n    },\n    watchScroll: function(){\n      if (viewModel.productsEnd.visible() && !viewModel.loading) {\n          viewModel.offset += 12;\n          if (viewModel.offset < viewModel.count)\n            viewModel.loadData(true);\n      }\n    },\n    loadData: function(dontRefreshFilters){\n        viewModel.loading = true;\n        var params = {filters: JSON.stringify(viewModel.filterNames), attributes: [], categories: viewModel.categories,\n            limit: viewModel.limit, offset: viewModel.offset};\n        this.filters().forEach(function(f){\n            var a = [];\n            if (f.selectedOptions)\n                f.selectedOptions().forEach(function(o){\n                    a.push(f.options.filter(function(option){ return o == option.slug;  })[0].slug);\n                });\n            if (a.length > 0)\n                params.attributes.push(a.join('.'));\n        });\n        params.attributes = params.attributes.join(',');\n        if (dontRefreshFilters)\n            params.dont_refresh_filters = true;\n        $.getJSON(\"/api/products/\", params , function(data){\n            viewModel.count = data.count;\n            viewModel.loading = false;\n            if (dontRefreshFilters){\n                viewModel.products(viewModel.products().concat(data.results.products));\n                return true;\n            }\n            viewModel.products(data.results.products);\n            var filters = viewModel.filters();\n            if (filters.length == 0){\n                data.results.filters.forEach(function(f){\n                    f.selectedOptions = ko.observableArray([]);\n                    f.options.forEach(function(option){\n                        option.disable = ko.observable(false);\n                    });\n                });\n                viewModel.filters(data.results.filters);\n                $('.selectpicker').selectpicker();\n            }\n            else {\n                data.results.filters.forEach(function (dataFilter, i) {\n                    //if (filters.length > 0)\n                    //    f.selectedOptions = filters[i].selectedOptions;  //f.options.filter(function(o){ return $.inArray(o, data.filters[i]); });\n                    //else\n                    //    f.selectedOptions = [];\n                    //if (!f.name)\n                    //    f.name = filters[i].name;\n                    var filter = viewModel.filters()[i];\n                    filter.options.forEach(function (option) {\n                        if (!dataFilter.options.find(function (o) {\n                                return o.slug == option.slug\n                            })) {\n                            option.disable(true);\n                        }\n                        else\n                            option.disable(false);\n                    });\n                });\n                $('.selectpicker').selectpicker('refresh');\n            }\n        });\n        $(window).unbind('scroll', viewModel.watchScroll);\n        $(window).bind('scroll', viewModel.watchScroll);\n    },\n    selectionChanged: function(event) {\n        viewModel.loadData();\n    }\n};\nko.applyBindings(viewModel);\n\n$(document).ready(function () {\n\n    viewModel.loadData();\n\n    $('#products-container').delegate('.image', 'mouseover', function () {\n        var parentId = $(this).parent().attr('data-id');\n        var product = viewModel.products().filter(function (p) {\n            if (p.id == parentId) return true;\n        })[0];\n        var image = $(this).find('img');\n        product.interval = window.setInterval(function () {\n            if (isNaN(product.currentImage))\n                product.currentImage = 0;\n            if (product.currentImage >= product.images.length)\n                product.currentImage = 0;\n            else\n                product.currentImage += 1;\n            image.attr('src', product.images[product.currentImage].original);\n        }, 1000);\n    });\n    $('#products-container').delegate('.image', 'mouseout', function () {\n        var parentId = $(this).parent().attr('data-id');\n        var product = viewModel.products().filter(function (p) {\n            if (p.id == parentId) return true;\n        })[0];\n        clearInterval(product.interval);\n    });\n    var categories = $('#product-categories').val();\n    $('#tree').treeview({\n        enableLinks: true,\n        data: JSON.parse($('#tree').attr('data')), expandIcon: 'fa fa-plus-square',\n        collapseIcon: 'fa fa-minus-square'\n    });\n});\n"]}