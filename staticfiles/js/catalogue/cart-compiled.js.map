{"version":3,"sources":["../../../../../../../../../home/jan/workspace/django_shop/shop/staticfiles/js/catalogue/cart.js"],"names":[],"mappings":"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","file":"cart-compiled.js","sourcesContent":["\"use strict\";\n\nvar HIDDEN_CART_URLS = ['/basket/', '/checkout/', '/zamowienie/', '/koszyk/'];\n\nclass Cart {\n    constructor(){\n        this.quantity = 0;\n        this.total = 0;\n    }\n    addToCart(id, quantity) {\n        var data = {quantity: quantity, url: window.location.origin + '/api/products/' + id + '/'}\n        $.post('/api/basket/add-product/', data, res => {\n            //$('body').append(Handlebars.templates['add-to-cart']({}));\n            //$(\"#message\").alert();\n            this.getCart();\n            //$('.cd-cart .body ul').append(Handlebars.templates['cart-product'](res));\n        });\n    }\n    deleteFromCart(line){\n        $.ajax({\n          type: 'DELETE',\n          url: line,\n          success: res => {\n            this.getCart();\n          }\n        });\n    }\n    updateCart(line, quantity){\n        $.ajax({\n          type: 'PUT',\n          url: line,\n          dataType: 'json',\n          data: {quantity: quantity},\n          success: res => {\n            this.getCart();\n          }\n        });\n    }\n    getCart(){\n        var me = this;\n        me.quantity = 0;\n        var c = Math.floor(Date.now() / 1000);\n        $.get('/api/basket/?c=' + c, res => {\n                me.total = res.total_incl_tax;\n                me.currency = res.currency;\n            $.get(res.lines + c, res => {\n                me.products = [];\n                res.forEach(function(r, i){\n                    var product = {line: r.url, quantity: r.quantity};\n                    me.quantity += r.quantity;\n                    product.price = r.price_incl_tax;\n                    $.ajax({\n                        url: r.product,\n                        async: false,\n                        success: res => {\n                            product.title =  res.title;\n                            product.image =  res.images.length > 0 ? res.images[0].original : '';\n                            me.products.push(product);\n                        }\n                    })\n                });\n                if (me.quantity > 0) {\n                    var cart = $('.cd-cart-container');\n                    cart.removeClass('empty');\n                    cart.removeClass('cart-open');\n                    cart.addClass('cart');\n                }\n                else {\n                    $('.cd-cart-container').addClass('empty');\n                    $('.cd-cart-container').removeClass('cart-open');\n                }\n                $('#cart-total').html(me.total);\n                $('#cart-count').html(me.quantity);\n                var productsList = $('.cd-cart .body ul');\n                productsList.html('');\n                me.products.forEach(function(r){\n                    productsList.append(Handlebars.templates['cart-product'](r));\n                    $('select[data-line=\"'+r.line+'\"]').val(r.quantity);\n                })\n            });\n        })\n    }\n}\n\nvar showCart = true;\nHIDDEN_CART_URLS.forEach(function(url){\n if (window.location.pathname.search(url) != -1)\n    showCart = false\n});\nif (showCart){\n    var cart = new Cart();\n    cart.getCart();\n}\n\n$(document).ready(() => {\n    $('#products-container').delegate('.add-to-cart', 'click', function (ev) {\n        cart.addToCart(parseInt($(ev.target).attr('data-id')), 1);\n    });\n    $('.cd-cart-trigger').click(function(el){\n        var container = $('.cd-cart-container');\n        if (container.hasClass('cart-open'))\n            $('.cd-cart-container').removeClass('cart-open');\n        else\n            $('.cd-cart-container').addClass('cart-open');\n    });\n    $('.cd-cart').delegate('.delete-item', 'click', function(ev){\n        var line = $(ev.target).attr('data-line');\n        cart.deleteFromCart(line);\n    });\n    $('.cd-cart').delegate('.product-quantity', 'change', function(ev){\n        var line = $(ev.target).attr('data-line');\n        var quantity = $(ev.target).val();\n        cart.updateCart(line, quantity);\n    });\n    $('.delete-item').click(function(){\n\n    });\n});\n\n// api/basket -> lines -> [0] product\n"]}