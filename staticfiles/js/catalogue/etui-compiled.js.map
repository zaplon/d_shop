{"version":3,"sources":["../../../../../../../../../home/jan/workspace/django_shop/shop/staticfiles/js/catalogue/etui.js"],"names":[],"mappings":"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","file":"etui-compiled.js","sourcesContent":["/// <reference path=\"../jquery.d.ts\" />\n/// <reference path=\"../handlebars.d.ts\" />\n/// <reference path=\"../utils.ts\" />\nvar Api = (function () {\n    function Api(url) {\n        this.url = url;\n        this.params = { limit: 0, attributes: '' };\n    }\n    Api.prototype.query = function (limit) {\n        var _this = this;\n        this.params.limit = limit;\n        if ('attributes' in this.params && this.params.attributes.length == 0)\n            delete this.params.attributes;\n        $.getJSON(this.url, this.params, function (res) {\n            _this.renderResults(res);\n            _this.appendResults = false;\n            history.pushState('', document.title, api.params.attributes);\n        });\n    };\n    ;\n    Api.prototype.watchResults = function () {\n        if (utils.isOnScreen(api.productsEnd, 0)) {\n            console.log('read');\n        }\n    };\n    Api.prototype.renderResults = function (res) {\n        if (!this.appendResults)\n            $('#products-container').html('');\n        for (var r in res.results) {\n            $('#products-container').append(Handlebars.templates['product'](res.results[r]));\n        }\n        $('#filters-list ul').html(Handlebars.templates['filters']({ attributes: this.attributes }));\n        console.log(this.attributes);\n        $('#products-container').append('<div id=\"products-end\"></div>');\n        this.productsEnd = $('#products-end');\n        $(window).unbind('scroll', this.watchResults);\n        $(window).bind('scroll', this.watchResults);\n    };\n    ;\n    return Api;\n}());\nvar api = new Api('/api/products/');\n$(document).ready(function () {\n    $('#filters-list').delegate('li', 'click', function () {\n        console.log('remove');\n        var select = $('select[data-attribute=\"' + $(this).attr('data-attribute') + '\"]');\n        //let values = $(select).selectpicker('val');\n        //if (typeof(values) == 'string'){\n        //    $(select).selectpicker('val', '');\n        //}\n        //else if (typeof(values) == 'object'){\n        //\n        //}\n        $(this).remove();\n    });\n    var productsEnd = $('#products-end');\n    $('#product-filters select').change(function (e) {\n        var attributes = [];\n        $('#product-filters select').each(function (i, s) {\n            var val = $(s).val();\n            if (typeof (val) == 'string' && val != '') {\n                var selected = $(s).find('option:selected');\n                attributes.push([{\n                        id: parseInt($(s).val()), name: $(selected).attr('name'),\n                        attribute: $(s).attr('data-attribute')\n                    }]);\n            }\n            else if (typeof (val) == 'object' && val !== null) {\n                attributes.push([]);\n                var a_length_1 = attributes.length - 1;\n                val.forEach(function (v, i) {\n                    attributes[a_length_1].push({\n                        id: parseInt(v), name: $(s).find('option[value=\"' + v + '\"]').attr('name'),\n                        attribute: $(s).attr('data-attribute')\n                    });\n                });\n            }\n        });\n        api.attributes = attributes;\n        var atts_ids = [];\n        attributes.forEach(function (att, i) {\n            atts_ids.push([]);\n            att.forEach(function (a, j) {\n                atts_ids[atts_ids.length - 1].push(a.id);\n            });\n            atts_ids[atts_ids.length - 1] = atts_ids[atts_ids.length - 1].join('.');\n        });\n        api.params.attributes = atts_ids.join(',');\n        api.query(12);\n    });\n    api.query(12);\n});\n//# sourceMappingURL=etui.js.map"]}